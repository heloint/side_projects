<?php
/* 3. Program that opens a file with text (selected by the user from among those
   available) and indicates in a table the number of words starting with each
   letter.
 */

require_once './lib/upload.php';
use uploadExercise\handleFiles as handleFiles;

$storageFiles = handleFiles\checkStorage('./data');

/* echo '$storageFiles </br> ============================</br>';
var_dump($storageFiles);
echo '</br>==============================</br>'; */

// If the submit button has been shot, then triggers the rest of the functions.
if (isset($_POST['upload']) &&
    is_uploaded_file($_FILES['file']['tmp_name'])){

        $checkFlag = handleFiles\checkFile($_FILES['file']);

        $storageFlag = handleFiles\lookForDuplicates($_FILES['file']['name'], 
                                                     $storageFiles
                                                    );

        $result = handleFiles\storeFile($_FILES['file'], 
                                        './data', 
                                        $checkFlag, 
                                        $storageFlag
                                       );

        $storageFiles = handleFiles\checkStorage('./data');

}
?>

<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
    <title>Upload files</title>
</head>
<body>
    <div class="banner-container">
        <h3><u>Upload files</u></h3> 
    </div>

    <div class="form-container">
        <div class="form-wrapper">
            <form action="index.php" method="post" enctype="multipart/form-data">
                <div class="upload-field">
                    <label for="file"><u>Upload your file here</u></label>
                    <input type="file" name="file">
                </div>
                <div class="submit-wrapper">
                    <button class="button" type="submit" name="upload">Upload</button>
                </div>
            </form>
        </div>
    </div> 
    
    <div id="test_id" class="output-container">
        <div class="output-wrapper">
        <?php
            echo $result['resultMessage'] ?? '';
        ?>
        </div>
    </div>

    <div class="form-container">
        <div class="form-wrapper">
        <?php
            $radioFormHTML = handleFiles\fetchRadioButtons($storageFiles);
            echo $radioFormHTML;
        ?>
        </div>
    </div>

    <div class="output-container">
        <div class="output-wrapper">
        <?php
            if (isset($_POST['read'])){
                printf('<p><u>Content of "%s"</u></p>', $_POST['selectedFile']);
                echo handleFiles\getFileContent('./data', $_POST['selectedFile']);
            }
        ?>
        </div>
    </div>

</body>
</html>
